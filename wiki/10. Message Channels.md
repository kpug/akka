# 10 Message Channels

이 장에서 살펴볼 것들

* Point to point
* Publish subscribe
* Eventbus
* Dead letter
* Guaranteed delivery
* Reliable-poxy

지금까지 살펴본 액터의 예제들이 Point to point이다. 다수의 receivers에게 메시지를 보내기 위해 publish-subscribe 구조를 사용할 수 있다. receivers는 채널로 유지되며 애플리케이션의 동작하는 동안 변경할 수 있다.
EventQueue나 EventBus라는 것도 있다. 아카는 EventStream을 가지고 publish-subscribe 채널을 구현한다.

특별한 2개의 채널 Dead Letter channel, Guaranteed delivery channel에 대해서도 설명할 예정이다.

## Channel types

포인트 투 포인트는 Sender에서 다른 포인트인 receiver로 연결한다. 이 경우 우리는 여러 채널이 필요하거나 Publish subscribe 채널을 사용한다. 이 채널의 다른 장점은 다수의 receiver가 애플리케이션의 동작에 따라 동적으로 변할 수 있다는 것이다.

### Point-to-Point

채널은 메시지를 Sender에서 receiver로 운송한다. Point-to-point 채널은 하나의 receiver로 메시지를 보낸다. 
이전 예제에서 sender는 프로세스의 다음 순서를 알고 있고 어떤 채널이 다음 스텝으로 이 메시지를 보내기 위해 사용할 채널을 알고 결정할 수 있었다.
섹션 7.1의 "파이프와 필터" 예제를 보면 이 예제에서 센더는 하나의 AkkaRef를 가지고 있고 이 AkkaRef는 액터가 처리를 끝냈을 때 메지시를 보낼 곳 이었다.
그러나 섹션 7.2.3의 RecipientList에서 처럼 액터가 다수의 채널을 가지고 있고 채널을 결정하거나 메시지를 보내기 위해 다수의 채널을 사용하는 경우도 있었다.

채널의 다른 특징은 여러 메시지가 이 메시지의 순서가 변경되지 않고 보낼 때이다. point-to-point 채널은 아래 그림 처럼 특정 하나의 Receiver로 메시지를 배달한다.

![그림10.1](https://raw.githubusercontent.com/kpug/akka/master/wiki/img/figure10.1.png)

point-to-point 채널도 여러 Receivers를 가질 수 있다. 그러나 채널은 오직 하나의 Receiver에게만 메시지를 보낸다. 라운드-로빈 라우터는 여러 Receiver를 갖는 채널의 예제이다.

![그림10.2]()

채널은 여러 receiver를 가질수 있지만 모든 메시지는 한 receiver에게만 전달된다. 이런 종류의 채널은 sender와 receiver 사이의 연결이 정적인 특성이 있을 때 사용한다. sender는 receiver에 닿기 위해 사용할 채널에 대해서 알고 있다.

이런 종류의 채널은 아카에서 사용하는 아주 일반적인 채널이다. 왜냐하면 Akka의 ActorRef는 point-to-point 채널의 구현체이기 때문이다. 또한 모든 메시지는 하나의 액터로 보내지며, 메시지의 순서도 액터로 배달되는 동안 변경되지 않는다.

### 10.1.2 Publish subscribe

가끔 sender는 누가 이 메시지에 관심이 있는지 알수 없다. 이것이 point-to-point와 Publish-subscribe 채널의 가장 큰 차이점이다. 채널은 sender 대신 메시지가 필요한 receivers의 트랙을 유지할 책임이 있고, 또한 동일한 메시지를 여러 receivers에게 전달할 수 있다

채널은 sender가 receiver를 알지 못해도 여러 receivers에게 동일한 메시지를 보낼 수 있다.

receiver가 publisher의 메시지에 관심이 있을 때, 이는 채널을 통해 스스로 구독하게 된다. publisher가 채널을 통해 메시지를 보낼 때 채널은 모든 subscribers가 메시지를 받을 수 있도록 보장한다.

이는 채널 메소드가 2개의 용도로 분리될 수 있게 만든다. 첫 번째 용도는 send side에서 끝나는 것으로 메시지가 발행될수 있도록 하는 것이다. 다른 용도는 receiver side에 있는 것으로 채널을 통해 Subscribe하고 Unsubscribe할 수 있는 것이다.

왜냐하면 Receivers는 채널으로부터 스스로 구독할 수 있으므로, 해결책이 아주 유연하다. publishe는 얼마나 많은 receivers가 있는지 알 필요가 없다.

#### AKKA EVENRSTREAM

Akka는 또한 이 종류의 채널도 지원한다. publish-subscribe 채널이 필요할 때 아주 쉬운 것은 EventStream을 사용하는 것이다. 모든 ActorSystem이 하나를 가지고 있으며, 모든 액터에서 사용 가능하다. EventStream은 다수의 Publish-Subscribe채널의 관리자로 볼 수 있다. 왜냐하면 액터는 특정 메시지 타입을 구독할 수 있고 누군가가 특정 타입의 메시지를 publish할 때 액터는 그 메시지를 받을 수 있다.

